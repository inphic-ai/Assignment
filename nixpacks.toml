# Nixpacks 配置 - Node.js 後端應用
# 此專案是全端應用，後端使用 Express，前端使用 Vite

[phases.setup]
nixPkgs = ["nodejs_20", "pnpm"]
# 明確排除 Caddy，因為我們使用 Express 作為伺服器
aptPkgs = []

[phases.install]
cmds = ["pnpm install"]

[phases.build]
cmds = [
  "pnpm db:generate",
  "pnpm build",
  "npx tsc api/server.ts api/project.ts api/task.ts api/ai.ts services/db.ts --outDir dist --esModuleInterop --module commonjs --target ES2020 --skipLibCheck"
]

[start]
cmd = "node dist/api/server.js"
